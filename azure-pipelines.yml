# Docker image
# Build a Docker image to deploy, run, or push to a container registry.
# Add steps that use Docker Compose, tag images, push to a registry, run an image, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
  branches:
    include:
    - develop
  paths:
    include:
    - src
    - scripts
    - public
    - config
    - nginx

pool:
  vmImage: 'Ubuntu-16.04'

variables:
  webImageName: 'embryonic-web-app:$(build.buildId)'

steps:
- script: |
    docker login -u "$(acrusername)" -p "$(acrpassword)" $(dockerid).azurecr.io
    docker build --build-arg MICROSCANNER_TOKEN=$(microscanner_token) -f ./Dockerfile-Prod -t $(dockerid).azurecr.io/$(webImageName) .
    docker push $(dockerid).azurecr.io/$(webImageName)
  displayName: 'Web docker build'